parameters:
  - name: projectsRoot
    type: string
  - name: umbracoProjectName
    type: string
  - name: buildConfiguration
    type: string

stages:
  - stage: build
    displayName: Build and Publish
    jobs:
      - job: build
        displayName: Build
        steps:

          - task: DotNetCoreCLI@2
            displayName: 'Build Solution'
            inputs:
              command: build
              projects: '**/*.csproj'
              arguments: '--configuration ${{parameters.buildConfiguration}}'

          - task: DotNetCoreCLI@2
            displayName: 'Publish Umbracosite Project'
            inputs:
              command: publish
              publishWebProjects: False
              projects: '${{parameters.projectsRoot}}/${{parameters.umbracoProjectName}}/${{parameters.umbracoProjectName}}.csproj'
              arguments: '--configuration ${{parameters.buildConfiguration}} --output $(Build.ArtifactStagingDirectory)/umbraco'
              zipAfterPublish: True
              
          - task: PublishBuildArtifacts@1
            displayName: 'Publish Umbracosite Artifact'
            inputs:
              pathtoPublish: '$(Build.ArtifactStagingDirectory)/umbraco'
              artifactName: 'umbraco'